<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>More powerful test for  the graph fused lasso — fusedlasso_inf • PGInference</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  

<meta property="og:title" content="More powerful test for  the graph fused lasso — fusedlasso_inf" />
<meta property="og:description" content="This functions tests the null hypothesis of no difference in means between
connected components c1 and c2 of the output of the graph fused
lasso solution. The ordering are numbered as per the results of the fusedlasso
function in the genlasso package." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PGInference</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/technical_details.html">Technical details</a>
</li>
<li>
  <a href="../articles/Tutorials.html">Software tutorials</a>
</li>
<li>
  <a href="../articles/real_data_example.html">Real data example</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>More powerful test for  the graph fused lasso</h1>
    
    <div class="hidden name"><code>fusedlasso_inf.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This functions tests the null hypothesis of no difference in means between
connected components <code>c1</code> and <code>c2</code> of the output of the graph fused
lasso solution. The ordering are numbered as per the results of the <code>fusedlasso</code>
function in the <code>genlasso</code> package.</p>
    </div>

    <pre class="usage"><span class='fu'>fusedlasso_inf</span><span class='op'>(</span>
  <span class='va'>y</span>,
  <span class='va'>D</span>,
  <span class='va'>c1</span>,
  <span class='va'>c2</span>,
  <span class='va'>method</span>,
  <span class='va'>sigma</span>,
  K <span class='op'>=</span> <span class='cn'>NULL</span>,
  c <span class='op'>=</span> <span class='cn'>NULL</span>,
  early_stop <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>y</th>
      <td><p>Numeric vector; \(p\) dimensional observed data</p></td>
    </tr>
    <tr>
      <th>D</th>
      <td><p>Numeric matrix; \(m\) by \(p\) penalty matrix, i.e.,
the oriented incidence matrix over the underlying graph</p></td>
    </tr>
    <tr>
      <th>c1, c2</th>
      <td><p>Integers selecting the two clusters to test, as indexed by the results of
<code><a href='https://rdrr.io/pkg/genlasso/man/fusedlasso.html'>genlasso::fusedlasso</a></code>.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>One of "K" or "CC", which indicates which conditioning set to use</p></td>
    </tr>
    <tr>
      <th>sigma</th>
      <td><p>Numeric; noise standard deviation for the observed data, a non-negative number.</p></td>
    </tr>
    <tr>
      <th>K</th>
      <td><p>Integer; number of steps to run the dual-path algorithm.
It must be specified if method=="K".</p></td>
    </tr>
    <tr>
      <th>c</th>
      <td><p>Integer; the targeted number of connected components.
It must be specified if method=="CC".</p></td>
    </tr>
    <tr>
      <th>early_stop</th>
      <td><p>Numeric; specify when the truncation set computation
should be terminated. The default is NULL, which indicates infinity.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns a list with elements:</p><ul>
<li><p><code>Union</code> the p-value proposed in Chen et al. (2021+)</p></li>
<li><p><code>truncation_set</code> the conditioning set of Chen et al. (2021+) stored as <code>Intervals</code> class</p></li>
<li><p><code>test_stats</code> test statistics: the difference in means of two connected components</p></li>
<li><p><code>beta_hat</code> Graph fused lasso estimates</p></li>
<li><p><code>connected_comp</code> Estimated connected component</p></li>
<li><p><code>Naive</code> the naive p-value using a z-test</p></li>
<li><p><code>Hyun</code> the p-value proposed in Hyun et al. (2018)</p></li>
<li><p><code>hyun_set</code> the conditioning set of  Hyun et al. (2018) stored as <code>Intervals</code> class</p></li>
</ul>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Currently, we support two different conditioning sets: conditioning set 1 is based on
the output after K steps dual-path algorithm; and conditioning set 2 is based on the
output of the after the dual-path algorithm yields c connected components in the output.</p>
<p>Input:</p>
<p>Consider the generative model \(Y_t = \beta_t + \epsilon_t, \epsilon_t \sim N(0, \sigma^2)\), where
the underlying signal \(\beta\) is assumed to be piecewise constant with respect to an underlying
graph. The fused lasso estimate minimizes the following objective function
$$minimize_{\beta} \frac{1}{2} \sum_{i=1}^{p} ( y_i - \beta_i )^2 + \lambda \sum_{(i,j)\in E}|\beta_i-\beta_j|,$$
where E is the edge set of the underlying graph. The solution \(\hat{\beta}\) can then be
segment into connected components; that is, the set of \(\hat{\beta}\) that takes on the
same value, and are connected in the original graph.</p>
<p>Now suppose we want to test whether the means of two estimated connected components <code>c1</code> and <code>c2</code>
are equal; or equivalently, the null hypothesis of the form \(H_{0}:  \nu^T \beta = 0\) versus
\(H_{1}:  \nu^T \beta \neq 0\) for suitably chosen \(\nu\).</p>
<p>This function computes the following p-value:
$$P(|\nu^T Y \geq \nu^T y |  \hat{c}_1, \hat{c}_2 \in CC_K(Y),  \Pi_\nu^\perp Y  =  \Pi_\nu^\perp y)$$,
where \(CC_K(Y)\) is the set of connected components estimated from Y via K steps of dual-path algorithm that
solves the fused lasso objective, and \(\Pi_\nu^\perp\) is the orthogonal projection to the orthogonal complement of \(\nu\).
In particular, this p-value controls the selective Type I error and has higher power than an existing method
by Hyun et al. (2018). Readers can refer to the Section 3 in Chen et al. (2021+) for more details.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Chen YT, Jewell SW, Witten DM. (2021+) More powerful selective inference for the graph fused lasso
Hyun S, G’Sell M, Tibshirani RJ. (2018) Exact post-selection inference for the generalized lasso path. Electron J Stat.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>lev1</span> <span class='op'>&lt;-</span> <span class='fl'>0</span> <span class='co'># mean for group 1</span>
<span class='va'>lev2</span> <span class='op'>&lt;-</span> <span class='fl'>3</span> <span class='co'># mean (absolute value) for group 2/3</span>
<span class='va'>sigma</span> <span class='op'>&lt;-</span> <span class='fl'>1</span> <span class='co'># level of noise</span>
<span class='va'>nn</span> <span class='op'>&lt;-</span> <span class='fl'>8</span> <span class='co'># grid size</span>
<span class='va'>Dmat</span> <span class='op'>&lt;-</span> <span class='fu'>graph2D_Dmat</span><span class='op'>(</span><span class='va'>nn</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span> <span class='co'># generate D matrix for the 2D fused lasso</span>
<span class='co'>### Create the underlying signal</span>
<span class='va'>A</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>lev1</span>, ncol<span class='op'>=</span><span class='va'>nn</span>, nrow <span class='op'>=</span> <span class='va'>nn</span><span class='op'>)</span>
<span class='va'>A</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>nn</span><span class='op'>/</span><span class='fl'>3</span><span class='op'>)</span>,<span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>nn</span><span class='op'>/</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>*</span><span class='va'>lev2</span>
<span class='va'>A</span><span class='op'>[</span><span class='op'>(</span><span class='va'>nn</span><span class='op'>-</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>:</span><span class='op'>(</span><span class='va'>nn</span><span class='op'>)</span>,<span class='op'>(</span><span class='va'>nn</span><span class='op'>-</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>:</span><span class='op'>(</span><span class='va'>nn</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>1</span><span class='op'>*</span><span class='va'>lev2</span>
<span class='co'>### Visualize the underlying signal</span>
<span class='fu'>lattice</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lattice/man/levelplot.html'>levelplot</a></span><span class='op'>(</span><span class='va'>A</span><span class='op'>)</span>
</div><div class='img'><img src='fusedlasso_inf-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>2005</span><span class='op'>)</span>
<span class='va'>A.noisy</span> <span class='op'>&lt;-</span> <span class='va'>A</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>nn</span><span class='op'>^</span><span class='fl'>2</span>,mean<span class='op'>=</span><span class='fl'>0</span>,sd<span class='op'>=</span><span class='va'>sigma</span><span class='op'>)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/do.call.html'>do.call</a></span><span class='op'>(</span><span class='va'>c</span>,<span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>A.noisy</span><span class='op'>)</span>,<span class='kw'>function</span><span class='op'>(</span><span class='va'>irow</span><span class='op'>)</span><span class='va'>A.noisy</span><span class='op'>[</span><span class='va'>irow</span>,<span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>### Run a test for a difference in means between estimated clusters 1 and 2</span>
<span class='va'>result_demo</span> <span class='op'>&lt;-</span> <span class='fu'>fusedlasso_inf</span><span class='op'>(</span>y<span class='op'>=</span><span class='va'>y</span>, D<span class='op'>=</span><span class='va'>Dmat</span>, c1<span class='op'>=</span><span class='fl'>1</span>, c2<span class='op'>=</span><span class='fl'>2</span>, method<span class='op'>=</span><span class='st'>"K"</span>, sigma<span class='op'>=</span><span class='va'>sigma</span>, K<span class='op'>=</span><span class='fl'>13</span><span class='op'>)</span>
<span class='co'>### Check the graph fused lasso estimate</span>
<span class='va'>beta_hat_K</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>result_demo</span><span class='op'>$</span><span class='va'>beta_hat</span>, nrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>A</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'>lattice</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lattice/man/levelplot.html'>levelplot</a></span><span class='op'>(</span><span class='va'>beta_hat_K</span><span class='op'>)</span>
</div><div class='img'><img src='fusedlasso_inf-2.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Yiqun Chen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


